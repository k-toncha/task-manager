# Task Manager API

REST API-сервис для управления задачами пользователей.

## Основные сущности

### User

- используется встроенная модель пользователя Django
- идентификация пользователя происходит по id
- аутентификация упрощена и выполняется через HTTP-заголовок X-User-Id

### Task
- `id`
- `title` — строка, обязательное
- `description` — строка, опционально
- `status` — `todo`, `in_progress`, `done`
- `due_date` — дедлайн, опционально
- `is_overdue` — флаг просрочки
- `owner` — пользователь
- `created_at`, `updated_at`

---

## Аутентификация

Для упрощения используется HTTP-заголовок:

```
X-User-Id: <user_id>
```

Считается, что пользователь с таким `id` существует.

---

## Бизнес-правила

- Пользователь может работать **только со своими задачами**
- Нельзя просматривать, изменять или удалять задачи других пользователей
- Поле `owner` нельзя изменить
- При установке `status = "done"` поле `due_date` **обязательно**
- При нарушении правил возвращается `400 Bad Request`

---

## API эндпоинты

### Создание задачи
```
POST /api/tasks/
```

---

### Список задач текущего пользователя
```
GET /api/tasks/
```

Поддерживаются:
- фильтрация по `status`
- фильтрация по диапазону `due_date` (`due_from`, `due_to`)
- пагинация (`limit`, `offset`)

Пример:
```
/api/tasks/?status=todo&due_from=2025-01-01&limit=10
```

---

### Получение задачи по id
```
GET /api/tasks/{id}/
```

---

### Обновление задачи
```
PUT /api/tasks/{id}/
PATCH /api/tasks/{id}/
```

---

### Удаление задачи
```
DELETE /api/tasks/{id}/
```

---

## Просроченные задачи

Задача считается просроченной, если:
- `due_date < now()`
- `status != "done"`

Бизнес-логика вынесена в отдельный сервис.

### Служебный эндпоинт (только для администратора)
```
POST /api/tasks/recalculate_overdue/
```

---

## Автотесты

Добавлен минимальный набор API-тестов:
- успешное создание задачи
- проверка бизнес-правила (`status="done"` без `due_date`)
- проверка доступа (нельзя удалить чужую задачу)

Запуск тестов:
```
python manage.py test
```

---

## Запуск через Docker

Проект использует **SQLite (`db.sqlite3`)** для упрощения запуска.

### Запуск
```
docker-compose up --build
```

После запуска сервис доступен по адресу:
```
http://localhost:8000/api/tasks/
```

---

### Миграции

Миграции применяются автоматически при старте контейнера.

---

### Создание администратора
```
docker-compose exec web python manage.py createsuperuser
```

